<wdkModel>
  <querySet name="IsolateIds" queryType="id" includeProjects="CryptoDB,PlasmoDB,ToxoDB,GiardiaDB,EuPathDB">

   <!-- notes
      
      - changed ms_assay param names
      - all components will have orfs so i changed the includes/excluded to reflect that

    -->
    
    <!-- ************************************************************ -->
    <!-- Isolate ID -->  
    <!-- ************************************************************ -->
 
    <sqlQuery name="IsolateByIsolateId" doNotTest="true" includeProjects="CryptoDB,PlasmoDB,ToxoDB,GiardiaDB"
              displayName="ID" isCacheable="true">
        <paramRef ref="isolateParams.isolate_id"/>
        <column name="source_id"/>
        <column name="project_id"/>
        <sql>
            <![CDATA[
                SELECT distinct i.source_id as source_id, 
                       '@PROJECT_ID@' as project_id
                FROM   apidb.isolateattributes i,
                       @WDK_ENGINE_SCHEMA@dataset_values@USER_DBLINK@ ds
                 WHERE ds.dataset_id = $$isolate_id$$
                   AND lower(i.source_id) LIKE REGEXP_REPLACE(REPLACE(LOWER(ds.dataset_value),
                                                       '*', '%'), '[[:space:]]', '')
            ]]>
        </sql>

    </sqlQuery>

    <processQuery name="IsolateByIsolateId" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <paramRef ref="isolateParams.isolate_id"/>
       <paramRef ref="sharedParams.signature"  quote="false"/>    
       <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
    </processQuery>


    <!-- ************************************************************ -->
    <!-- Isolate Author -->
    <!-- ************************************************************ -->

    <sqlQuery name="IsolateByAuthor" doNotTest="true"  includeProjects="CryptoDB,PlasmoDB,ToxoDB,GiardiaDB"
              displayName="Author" isCacheable="true">
      <paramRef ref="isolateParams.author"/>
      <column name="source_id"/>
      <column name="project_id"/>
      <sql>
      <![CDATA[
          SELECT distinct etn.source_id as source_id,
                 '@PROJECT_ID@' as project_id
          FROM   DoTS.ExternalNASequence etn,
                 DoTS.NASequenceRef nasr,
                 SRES.Reference ref,
                 SRes.ExternalDatabaseRelease edr,
                 SRes.ExternalDatabase edb
          WHERE  nasr.reference_id = ref.reference_id
             AND edr.external_database_id = edb.external_database_id
             AND edr.external_database_release_id = etn.external_database_release_id
             AND edb.name = 'Isolates Data'
             AND edr.version = '2007-12-12'
             AND etn.na_sequence_id = nasr.na_sequence_id
             AND LOWER(ref.author) LIKE LOWER('%' || REPLACE($$author$$,'*','%') || '%')
         ]]>
      </sql>
    </sqlQuery>

    <processQuery name="IsolateByAuthor" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <paramRef ref="isolateParams.author" quote="false"/>
      <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
    </processQuery>


    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Taxon (Species, Organism) -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="IsolateByTaxon" includeProjects="CryptoDB,PlasmoDB,ToxoDB,GiardiaDB" isCacheable="true">
     <!--  <paramRef ref="isolateParams.isolate_organism" queryRef="organismIQ.withIsolates" quote="true" includeProjects="CryptoDB"/> -->
        <paramRef ref="isolateParams.strain" queryRef="strainVQ.withIsolates" quote="true"/>
        <paramRef ref="isolateParams.type" includeProjects="PlasmoDB,ToxoDB"/>
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="data_type" includeProjects="PlasmoDB,ToxoDB"/>
        <sqlParamValue name="dataTypeOptional" includeProjects="CryptoDB,GiardiaDB">        </sqlParamValue>
        <sqlParamValue name="dataTypeOptional" includeProjects="PlasmoDB,ToxoDB">
            <![CDATA[
             AND  i.data_type in ($$type$$) 
            ]]>
        </sqlParamValue>
        <sql>
          <![CDATA[
           select i.source_id, '@PROJECT_ID@' as project_id, i.data_type
            from apidb.isolateattributes i
            where i.organism in ($$strain$$)
            &&dataTypeOptional&&
            ]]>
         </sql>
    </sqlQuery>

    <processQuery name="IsolateByTaxon" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
   <!--   <paramRef ref="isolateParams.isolate_organism" queryRef="organismIQ.withIsolates" quote="true"/>  -->
      <paramRef ref="isolateParams.strain" queryRef="strainVQ.withIsolates"  quote="false"/>
      <paramRef ref="isolateParams.type"  quote="false"/>
      <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
    </processQuery>


    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Host name (Specific_host) -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="IsolateByHost" includeProjects="CryptoDB,PlasmoDB,ToxoDB,GiardiaDB"
              isCacheable="true">

        <testParamValues includeProjects="CryptoDB,PlasmoDB,ToxoDB,GiardiaDB">
            <paramValue name="specific_host">Mammals - Human</paramValue>
        </testParamValues>     

        <paramRef ref="isolateParams.specific_host" queryRef="hostVQ.withIsolates" quote="true"/>
        <paramRef ref="isolateParams.type" includeProjects="ToxoDB,PlasmoDB"/>
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="data_type" includeProjects="PlasmoDB,ToxoDB"/>
        <sqlParamValue name="dataTypeOptional" includeProjects="CryptoDB,GiardiaDB">
        </sqlParamValue>
        <sqlParamValue name="dataTypeOptional" includeProjects="ToxoDB,PlasmoDB">
            <![CDATA[
             AND  i.data_type in ($$type$$) 
            ]]>
        </sqlParamValue>
        <sql >
          <![CDATA[
           select distinct i.source_id, '@PROJECT_ID@' as project_id, i.data_type
           from   apidb.isolatevocabulary v,
                  apidb.isolatemapping m,
                  apidb.isolateattributes i
           where  v.type = 'specific_host'
           and    v.isolate_vocabulary_id = m.isolate_vocabulary_id
           and    i.na_sequence_id = m.na_sequence_id 
           and    initcap(v.term) in ($$specific_host$$)
           &&dataTypeOptional&&
           ORDER BY i.source_id
           ]]>
<!--
           select distinct i.source_id, '@PROJECT_ID@' as project_id, i.data_type
            from apidb.isolatevocabulary v, 
                 (select source_id, data_type, trim(specific_host) as specific_host from apidb.isolateattributes) i
            where i.specific_host = trim(v.original_term)
            and trim(v.term) in ($$specific_host$$)
            and v.type = 'specific_host' 
            &&dataTypeOptional&&
            ORDER BY i.source_id
            ]]>
-->
         </sql>
    </sqlQuery>

    <processQuery name="IsolateByHost" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <paramRef ref="isolateParams.specific_host" queryRef="hostVQ.withIsolates"/>
      <paramRef ref="isolateParams.type"/>
      <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
    </processQuery>


    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Isolation Source -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="IsolateByIsolationSource" includeProjects="CryptoDB,ToxoDB,PlasmoDB,GiardiaDB" isCacheable="true">
        <paramRef ref="isolateParams.isolation_source" queryRef="isolationSourceVQ.withIsolates" quote="true"/>
        <column name="source_id"/>
        <column name="project_id"/>
        <sql >
          <![CDATA[
           select distinct i.source_id, '@PROJECT_ID@' as project_id, i.data_type
           from   apidb.isolatevocabulary v,
                  apidb.isolatemapping m,
                  apidb.isolateattributes i
           where  v.isolate_vocabulary_id = m.isolate_vocabulary_id
           and    i.na_sequence_id = m.na_sequence_id 
           and    trim(v.term) in ($$isolation_source$$) 
           ORDER BY i.source_id
            ]]>
         </sql>
    </sqlQuery>

    <processQuery name="IsolateByIsolationSource" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <paramRef ref="isolateParams.isolation_source" queryRef="isolationSourceVQ.withIsolates"/>
      <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
    </processQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Isolate by Product -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="IsolateByProduct" includeProjects="CryptoDB,PlasmoDB,ToxoDB,GiardiaDB" isCacheable="true">
        <paramRef ref="isolateParams.product" queryRef="productVQ.withIsolates" quote="true"/>
        <column name="source_id"/>
        <column name="project_id"/>
        <sql >
          <![CDATA[
            SELECT distinct ia.source_id, '@PROJECT_ID@' as project_id 
            from apidb.ISOLATEVOCABULARY v, apidb.ISOLATEMAPPING m, apidb.ISOLATEATTRIBUTES ia
            where v.term = $$product$$
            and v.isolate_vocabulary_id = m.isolate_vocabulary_id
            and m.na_sequence_id = ia.na_sequence_id
            ]]>
         </sql>
    </sqlQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Isolate by Genotype Number -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="IsolateByGenotypeNumber" includeProjects="ToxoDB" isCacheable="true">
        <paramRef ref="isolateParams.genotype" queryRef="genotypeVQ.withIsolates" quote="true"/>
        <column name="source_id"/>
        <column name="project_id"/>
        <sql >
          <![CDATA[
          SELECT distinct s.source_id, '@PROJECT_ID@' as project_id, 'Genotype' as data_type 
          FROM   apidb.isolateattributes s, 
                 dots.isolatefeature if 
          WHERE  s.na_sequence_id = if.na_sequence_id 
             AND if.prediction_number in ($$genotype$$) 
             AND s.data_type = 'RFLP Typed' 
          ORDER BY source_id
          ]]>
         </sql>
    </sqlQuery>

    <processQuery name="IsolateByGenotypeNumber" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <paramRef ref="isolateParams.genotype" queryRef="genotypeVQ.withIsolates"/>
      <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
    </processQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Isolate by RFLP Genotype Number -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="IsolateByRFLPGenotype" includeProjects="ToxoDB" isCacheable="true">
        <paramRef ref="isolateParams.rflp_protein_SAG1" quote="true"/>
        <paramRef ref="isolateParams.rflp_protein_53_SAG2" quote="true"/>
        <paramRef ref="isolateParams.rflp_protein_alt_SAG2" quote="true"/>
        <paramRef ref="isolateParams.rflp_protein_SAG3" quote="true"/>
        <paramRef ref="isolateParams.rflp_protein_BTUB" quote="true"/>
        <paramRef ref="isolateParams.rflp_protein_GRA6" quote="true"/>
        <paramRef ref="isolateParams.rflp_protein_c22-8" quote="true"/>
        <paramRef ref="isolateParams.rflp_protein_c29-2" quote="true"/>
        <paramRef ref="isolateParams.rflp_protein_L358" quote="true"/>
        <paramRef ref="isolateParams.rflp_protein_PK1" quote="true"/>
        <paramRef ref="isolateParams.rflp_protein_Apico" quote="true"/>
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="data_type"/>
        <sql >
          <![CDATA[
          SELECT distinct s.source_id, '@PROJECT_ID@' as project_id, 'Genotype' as data_type 
          FROM   dots.isolatefeature f, dots.nasequence s
          WHERE  f.na_sequence_id = s.na_sequence_id 
             AND f.product = 'SAG1' and ($$rflp_protein_SAG1$$ = 'all' OR f.gene_type = $$rflp_protein_SAG1$$) 
             AND f.name = 'RFLP' 
          INTERSECT
          SELECT distinct s.source_id, '@PROJECT_ID@' as project_id, 'Genotype' as data_type 
          FROM   dots.isolatefeature f, dots.nasequence s
          WHERE  f.na_sequence_id = s.na_sequence_id 
             AND f.product = '5''+3'' SAG2' and ($$rflp_protein_53_SAG2$$ = 'all' OR f.gene_type = $$rflp_protein_53_SAG2$$) 
             AND f.name = 'RFLP' 
          INTERSECT
          SELECT distinct s.source_id, '@PROJECT_ID@' as project_id, 'Genotype' as data_type 
          FROM   dots.isolatefeature f, dots.nasequence s
          WHERE  f.na_sequence_id = s.na_sequence_id 
             AND f.product = 'alt. SAG2' and ($$rflp_protein_alt_SAG2$$ = 'all' OR f.gene_type = $$rflp_protein_alt_SAG2$$) 
             AND f.name = 'RFLP' 
          INTERSECT
          SELECT distinct s.source_id, '@PROJECT_ID@' as project_id, 'Genotype' as data_type 
          FROM   dots.isolatefeature f, dots.nasequence s
          WHERE  f.na_sequence_id = s.na_sequence_id 
             AND f.product = 'Apico' and ($$rflp_protein_Apico$$ = 'all' OR f.gene_type = $$rflp_protein_Apico$$) 
             AND f.name = 'RFLP' 
          INTERSECT
          SELECT distinct s.source_id, '@PROJECT_ID@' as project_id, 'Genotype' as data_type 
          FROM   dots.isolatefeature f, dots.nasequence s
          WHERE  f.na_sequence_id = s.na_sequence_id 
             AND f.product = 'BTUB' and ($$rflp_protein_BTUB$$ = 'all' OR f.gene_type = $$rflp_protein_BTUB$$) 
             AND f.name = 'RFLP' 
          INTERSECT
          SELECT distinct s.source_id, '@PROJECT_ID@' as project_id, 'Genotype' as data_type 
          FROM   dots.isolatefeature f, dots.nasequence s
          WHERE  f.na_sequence_id = s.na_sequence_id 
             AND f.product = 'GRA6' and ($$rflp_protein_GRA6$$ = 'all' OR f.gene_type = $$rflp_protein_GRA6$$) 
             AND f.name = 'RFLP' 
          INTERSECT
          SELECT distinct s.source_id, '@PROJECT_ID@' as project_id, 'Genotype' as data_type 
          FROM   dots.isolatefeature f, dots.nasequence s
          WHERE  f.na_sequence_id = s.na_sequence_id 
             AND f.product = 'c22-8' and ($$rflp_protein_c22-8$$ = 'all' OR f.gene_type = $$rflp_protein_c22-8$$) 
             AND f.name = 'RFLP' 
          INTERSECT
          SELECT distinct s.source_id, '@PROJECT_ID@' as project_id, 'Genotype' as data_type 
          FROM   dots.isolatefeature f, dots.nasequence s
          WHERE  f.na_sequence_id = s.na_sequence_id 
             AND f.product = 'c29-2' and ($$rflp_protein_c29-2$$ = 'all' OR f.gene_type = $$rflp_protein_c29-2$$) 
             AND f.name = 'RFLP' 
          INTERSECT
          SELECT distinct s.source_id, '@PROJECT_ID@' as project_id, 'Genotype' as data_type 
          FROM   dots.isolatefeature f, dots.nasequence s
          WHERE  f.na_sequence_id = s.na_sequence_id 
             AND f.product = 'L358' and ($$rflp_protein_L358$$ = 'all' OR f.gene_type = $$rflp_protein_L358$$) 
             AND f.name = 'RFLP' 
          INTERSECT
          SELECT distinct s.source_id, '@PROJECT_ID@' as project_id, 'Genotype' as data_type 
          FROM   dots.isolatefeature f, dots.nasequence s
          WHERE  f.na_sequence_id = s.na_sequence_id 
             AND f.product = 'PK1' and ($$rflp_protein_PK1$$ = 'all' OR f.gene_type = $$rflp_protein_PK1$$) 
             AND f.name = 'RFLP' 
          INTERSECT
          SELECT distinct s.source_id, '@PROJECT_ID@' as project_id, 'Genotype' as data_type 
          FROM   dots.isolatefeature f, dots.nasequence s
          WHERE  f.na_sequence_id = s.na_sequence_id 
             AND f.product = 'SAG3' and ($$rflp_protein_SAG3$$ = 'all' OR f.gene_type = $$rflp_protein_SAG3$$) 
             AND f.name = 'RFLP' 
          ]]>
         </sql>
    </sqlQuery>

    <processQuery name="IsolateByRFLPGenotype" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <paramRef ref="isolateParams.rflp_protein_SAG1" quote="true"/>
      <paramRef ref="isolateParams.rflp_protein_53_SAG2" quote="true"/>
      <paramRef ref="isolateParams.rflp_protein_alt_SAG2" quote="true"/>
      <paramRef ref="isolateParams.rflp_protein_SAG3" quote="true"/>
      <paramRef ref="isolateParams.rflp_protein_BTUB" quote="true"/>
      <paramRef ref="isolateParams.rflp_protein_GRA6" quote="true"/>
      <paramRef ref="isolateParams.rflp_protein_c22-8" quote="true"/>
      <paramRef ref="isolateParams.rflp_protein_c29-2" quote="true"/>
      <paramRef ref="isolateParams.rflp_protein_L358" quote="true"/>
      <paramRef ref="isolateParams.rflp_protein_PK1" quote="true"/>
      <paramRef ref="isolateParams.rflp_protein_Apico" quote="true"/>
      <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
       <wsColumn name="data_type"  width="32"/>
    </processQuery>


    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Isolate by Study -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="IsolateByStudy" includeProjects="CryptoDB,PlasmoDB,ToxoDB,GiardiaDB" isCacheable="true">
        <paramRef ref="isolateParams.study" queryRef="studyVQ.withIsolates" quote="true"/>
        <column name="source_id"/>
        <column name="project_id"/>
        <sql>
          <![CDATA[
            SELECT DISTINCT etn.source_id, '@PROJECT_ID@' as project_id
            FROM DoTS.ExternalNASequence etn, 
                 DoTS.NASequenceRef nasr,
                 SRES.Reference ref,
                 apidb.isolateattributes ia
            WHERE nasr.reference_id = ref.reference_id
            AND nasr.na_sequence_id = etn.na_sequence_id
            and ia.source_id = etn.source_id
            AND ref.title IN $$study$$

            ]]>
         </sql>
    </sqlQuery>

    <processQuery name="IsolateByStudy" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <paramRef ref="isolateParams.study" queryRef="studyVQ.withIsolates"/>
      <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
    </processQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Isolate by Country -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="IsolateByCountry" includeProjects="CryptoDB,ToxoDB,GiardiaDB,PlasmoDB" isCacheable="true">

        <testParamValues includeProjects="CryptoDB">
            <paramValue name="country">France</paramValue>
        </testParamValues>     
        <testParamValues includeProjects="PlasmoDB">
            <paramValue name="country">Cambodia</paramValue>
        </testParamValues>    
        <testParamValues includeProjects="ToxoDB">
            <paramValue name="country">Poland</paramValue>
        </testParamValues>
        <testParamValues includeProjects="GiardiaDB">
            <paramValue name="country">Sweden</paramValue>
        </testParamValues>

        <paramRef ref="isolateParams.country" queryRef="countryVQ.withIsolates" quote="true"/>
        <paramRef ref="isolateParams.type" includeProjects="PlasmoDB,ToxoDB"/>
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="data_type"/>
        <sqlParamValue name="dataTypeOptional" includeProjects="CryptoDB,GiardiaDB">        </sqlParamValue>
        <sqlParamValue name="dataTypeOptional" includeProjects="PlasmoDB,ToxoDB">
            <![CDATA[
             AND  i.data_type in ($$type$$) 
            ]]>
        </sqlParamValue>
        <sql>
          <![CDATA[
           select distinct i.source_id, '@PROJECT_ID@' as project_id, i.data_type
           from   apidb.isolatevocabulary v,
                  apidb.isolatemapping m,
                  apidb.isolateattributes i
           where  v.type = 'geographic_location'
           and    v.isolate_vocabulary_id = m.isolate_vocabulary_id
           and    i.na_sequence_id = m.na_sequence_id 
           and    initcap(v.term) in ($$country$$)
           &&dataTypeOptional&&
           ORDER BY i.source_id
            ]]>
         </sql>
    </sqlQuery>

    <processQuery name="IsolateByCountry" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <paramRef ref="isolateParams.country" queryRef="countryVQ.withIsolates"  quote="false"/>
      <paramRef ref="isolateParams.type"  quote="false"/>
      <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
    </processQuery>

<!-- This query is now redundant and the option to query isolates by Submitter is covered by Text search question -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Isolate by Submitter -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
<!--
    <sqlQuery name="IsolateBySubmitter" includeProjects="PlasmoDB" isCacheable="true">
        <paramRef ref="isolateParams.submitter" queryRef="submitterVQ.withIsolates" quote="true"/>
        <column name="source_id"/>
        <column name="project_id"/>
        <column name="data_type"/>
        <sql>
          <![CDATA[
            SELECT DISTINCT src.source_id, '@PROJECT_ID@' as project_id,
                               src.data_type
            FROM   ApiDB.IsolateAttributes src
            WHERE  src.collected_by IN ($$submitter$$)
            ORDER BY src.source_id
            ]]>
         </sql>
    </sqlQuery>

    <processQuery name="IsolateBySubmitter" processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin" includeProjects="EuPathDB">
      <paramRef ref="isolateParams.submitter" queryRef="submitterVQ.withIsolates"/>
      <wsColumn name="source_id" width="32" wsName="source_id"/>
      <wsColumn name="project_id" width="32" wsName="project_id"/>
    </processQuery>
-->

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Isolates with Gene Overlap  -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="IsolateWithGeneOverlap" includeProjects="CryptoDB"
              displayName="Gene Name" isCacheable='true'>
      <paramRef ref="isolateParams.gene_id"/>
      <column name="source_id" />
      <column name="project_id"/>
      <sql>
         <![CDATA[
         SELECT distinct t.source_id,
                '@PROJECT_ID@' as project_id
         FROM   DoTS.GeneFeature gf, 
                DoTS.ExternalNASequence etn, 
                DoTS.NaLocation nal,
                 (SELECT source_id, target_name, min_subject_start, 
                         max_subject_end 
                  FROM ApiDB.IsolateAttributes) t
         WHERE etn.na_sequence_id = gf.na_sequence_id
           AND nal.na_feature_id = gf.na_feature_id
           AND t.target_name = etn.source_id
           AND nal.start_min <= t.max_subject_end 
           AND nal.end_max >= t.min_subject_start
           AND gf.source_id LIKE REPLACE($$gene_id$$,'*','%') 
        ]]>
      </sql> 
    </sqlQuery> 

    <processQuery name="IsolateWithGeneOverlap" includeProjects="EuPathDB"
        isCacheable='true' processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin">
        <paramRef ref="isolateParams.gene_id"/>
        <wsColumn name="source_id" width="60" wsName="source_id"/>
        <wsColumn name="project_id" width="32" wsName="project_id"/>
    </processQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- BLAST  -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <processQuery name="IsolatesBySimilarity"
             displayName="BLAST"
             processName="org.apidb.apicomplexa.wsfplugin.wublast.WuBlastPlugin">

        <testParamValues includeProjects="CryptoDB">
            <paramValue name="BlastQuerySequence">TATTTTGGAGGGTTCAATTGCAGGTATTAGAAGCGAATCTTGCGTTGTATCTG</paramValue>
            <paramValue name="BlastDatabaseType">Isolates</paramValue>
            <paramValue name="BlastDatabaseOrganism">All Cryptosporidium Isolates</paramValue>
        </testParamValues>

        <testParamValues includeProjects="PlasmoDB">
            <paramValue name="BlastQuerySequence">ATACCCGATCGAAGATATCAATTATGTATGAAGGAACTTACGAATTTGGTAAATAATACAGACACAAATTTTCATAGGGATATA</paramValue>
            <paramValue name="BlastDatabaseType">Isolates</paramValue>
            <paramValue name="BlastDatabaseOrganism">Plasmodium Popset/Genbank Isolates</paramValue>

        </testParamValues>

        <testParamValues includeProjects="ToxoDB">
            <paramValue name="BlastQuerySequence">AACTCGGCGCTCGATAAAACACCACAAACTGCTTAGAAGCACTTGCGGTGGACGATGCTCGGGCCAGACTCGTCGTACTC</paramValue>
            <paramValue name="BlastDatabaseType">Isolates</paramValue>
            <paramValue name="BlastDatabaseOrganism">All Toxoplasma Isolates</paramValue>
        </testParamValues>

        <testParamValues includeProjects="GiardiaDB">
            <paramValue name="BlastQuerySequence">GCCCAACGCGCTCTGGGACTGCGGGCTTCGCAGACGCATGAACGCATGATGAGGATTGATCTTCAAGCAAAGACATTTGT</paramValue>
            <paramValue name="BlastDatabaseType">Isolates</paramValue>
            <paramValue name="BlastDatabaseOrganism">All Giardia Isolates</paramValue>
        </testParamValues>

      <paramRef ref="sharedParams.BlastDatabaseType" quote="false" />
      <paramRef ref="sharedParams.BlastAlgorithm" quote="false" />
      <paramRef ref="genomicSimilarityParams.BlastDatabaseOrganism" quote="false" />
      <paramRef ref="sharedParams.BlastQuerySequence" quote="false" />
      <paramRef ref="sharedParams.-e" quote="false" />
      <paramRef ref="sharedParams.-v" quote="false" />
      <paramRef ref="sharedParams.-b" quote="false" />
      <paramRef ref="sharedParams.-filter" quote="false" />
      <wsColumn name="source_id" width="32" wsName="Identifier"/>
      <wsColumn name="project_id" width="32" wsName="ProjectId"/>
      <wsColumn name="TabularRow" width="3000"/>
      <wsColumn name="Alignment"  columnType="clob"/>
      <wsColumn name="Header" width="3000"/>
      <wsColumn name="Footer" width="3000"/>
 <wsColumn name="Counter" width="30" columnType="number"/>
    </processQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- keyword search (based on Oracle Text) -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <processQuery name="IsolatesByTextSearch" includeProjects="PlasmoDB,CryptoDB,ToxoDB,GiardiaDB"
          processName="org.apidb.apicomplexa.wsfplugin.textsearch.KeywordSearchPlugin">
       <paramRef ref="sharedParams.wdk_record_type" default="isolate"/>
       <paramRef ref="sharedParams.project_id" default="CryptoDB" includeProjects="CryptoDB"/>
       <paramRef ref="sharedParams.text_expression" default="Cryptosporidium hominis" includeProjects="CryptoDB"/>
       <paramRef ref="sharedParams.text_expression" default="Plasmodium falciparum" includeProjects="PlasmoDB"/>
       <paramRef ref="sharedParams.text_expression" default="Toxoplasma gondii" includeProjects="ToxoDB"/>
       <paramRef ref="sharedParams.text_expression" default="Giardia lamblia" includeProjects="GiardiaDB"/>
       <paramRef ref="isolateParams.text_fields"/>
       <wsColumn name="source_id" width="32" wsName="RecordID"/>
       <wsColumn name="project_id" width="32" wsName="ProjectId"/>
       <wsColumn name="max_score" width="10" wsName="MaxScore" columnType="float"/>
       <wsColumn name="fields_matched" width="64" wsName="Datasets"/>
    </processQuery>

   <processQuery name="IsolatesByTextSearch" includeProjects="EuPathDB"
        isCacheable='true' processName="org.apidb.apicomplexa.wsfplugin.apifed.ApiFedPlugin">
       <paramRef ref="sharedParams.wdk_record_type"  quote="false"  default="isolate"/>
       <paramRef ref="sharedParams.project_id" default="CryptoDB" quote="false"/>
       <paramRef ref="sharedParams.text_expression"  default="Cryptosporidium hominis" quote="false"/>
       <paramRef ref="isolateParams.text_fields"  quote="false"/>
       <wsColumn name="source_id" width="32" wsName="source_id"/>
       <wsColumn name="project_id" width="32" wsName="project_id"/>
       <wsColumn name="max_score" width="10" columnType="float"/>
       <wsColumn name="fields_matched" width="64"/>
    </processQuery>
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- dump all isolates -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="IsolateDump"
              isCacheable='true'>
      <paramRef ref="organismParams.gff_organism" queryRef="organismVQ.withGenesGFF"/>
      <column name="source_id" />
      <column name="project_id"/>
      <sql>
         <![CDATA[
         select ia.source_id, '@PROJECT_ID@' as project_id
         from apidb.IsolateAttributes ia
        ]]>
      </sql> 
    </sqlQuery> 

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Dont Care - fake query for internal use -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="DontCare" doNotTest="true" isCacheable="true">
        <column name="project_id"/>
        <column name="source_id"/>
        <sql>
            select source_id, project_id
            from apidb.isolateattributes
            where source_id = 'life_is_sweet'
        </sql>
    </sqlQuery>

    </querySet>

</wdkModel>
