<wdkModel>
    <querySet name="SequenceTables" queryType="table">

            <defaultTestParamValues includeProjects="PlasmoDB">
               <paramValue name="source_id">PB_PH0001</paramValue>
               <paramValue name="project_id">PlasmoDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="ToxoDB">
               <paramValue name="source_id">TGME49_chrIII</paramValue>
               <paramValue name="project_id">ToxoDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="CryptoDB">
               <paramValue name="source_id">AAEE01000001</paramValue>
               <paramValue name="project_id">CryptoDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="GiardiaDB">
               <paramValue name="source_id">CH991779</paramValue>
               <paramValue name="project_id">GiardiaDB</paramValue>
            </defaultTestParamValues>

            <defaultTestParamValues includeProjects="TrichDB">
               <paramValue name="source_id">DS113177</paramValue>
               <paramValue name="project_id">TrichDB</paramValue>
            </defaultTestParamValues>
            <!-- TODO revisit source_id --> 
            <defaultTestParamValues includeProjects="TriTrypDB">
               <paramValue name="source_id">AAHK01032731</paramValue>
               <paramValue name="project_id">TriTrypDB</paramValue>
            </defaultTestParamValues>


        <sqlQuery name="SequencePieces"
               isCacheable="false">

            <testParamValues minRows="0" includeProjects="TrichDB,CryptoDB,TriTrypDB"/>
            <testParamValues includeProjects="PlasmoDB">
                <paramValue name="source_id">CM000442</paramValue>
            </testParamValues>

            <column name="source_id" />
            <column name="project_id" />
            <column name="start_min" />
            <column name="end_max" />
            <column name="piece_source_id" />
            <column name="piece_min" />
            <column name="piece_max" />
            <column name="piece_strand" />
            <sql>
            <![CDATA[
          SELECT * FROM (
            select vs.source_id as source_id, '@PROJECT_ID@' AS project_id,
                   sp.distance_from_left + 1 as start_min, 
                   es.length + sp.distance_from_left as end_max,
                   case when es.source_id is null then '(N)-' || es.length else es.source_id end as piece_source_id,
                   1 as piece_min,
                   es.length as piece_max,
                   sp.strand_orientation as piece_strand,
                   sp.sequence_order
            from Dots.SEQUENCEPIECE sp, Dots.NASEQUENCE vs, Dots.NASEQUENCE es
            where vs.na_sequence_id = sp.virtual_na_sequence_id
            and es.na_sequence_id = sp.piece_na_sequence_id
            and sp.strand_orientation is not null
            UNION
            select es.source_id as source_id, '@PROJECT_ID@' AS project_id,
                   sp.distance_from_left + 1 as start_min, 
                   es.length + sp.distance_from_left as end_max,
                   case when es.source_id is null then '(N)-' || es.length else es.source_id end as piece_source_id,
                   1 as piece_min,
                   es.length as piece_max,
                   sp.strand_orientation as piece_strand,
                   sp.sequence_order
            from Dots.SEQUENCEPIECE sp, Dots.NASEQUENCE vs, Dots.NASEQUENCE es
            where vs.na_sequence_id = sp.virtual_na_sequence_id
            and es.na_sequence_id = sp.piece_na_sequence_id
            and sp.strand_orientation is not null
            )
            order by source_id, sequence_order
             ]]>
           </sql>
        </sqlQuery>



        <sqlQuery name="Centromere"
               isCacheable="false">

           <testParamValues includeProjects="PlasmoDB">
               <paramValue name="source_id">Pf3D7_05</paramValue>
            </testParamValues>
            <testParamValues minRows="0" includeProjects="ToxoDB,TrichDB,GiardiaDB,CryptoDB,TriTrypDB"/>

            <column name="source_id" />
            <column name="project_id" />
            <column name="start_min" />
            <column name="end_max" />
            <sql>
            <![CDATA[
            SELECT ens.source_id as source_id, '@PROJECT_ID@' AS project_id,
                   nl.start_min, nl.end_max
            FROM dots.NaSequence ens, dots.Miscellaneous m,
                 dots.NaLocation nl, sres.SequenceOntology so
            WHERE ens.na_sequence_id = m.na_sequence_id
              AND m.na_feature_id = nl.na_feature_id
              AND m.sequence_ontology_id = so.sequence_ontology_id
              AND so.term_name = 'centromere'
             ]]>
           </sql>
        </sqlQuery>

    <sqlQuery name="SequenceGffDbxrefs"  excludeProjects="EuPathDB" 
            isCacheable="false">
            <testParamValues includeProjects="ToxoDB">
               <paramValue name="source_id">TGME49_chrIa</paramValue>
            </testParamValues>

        <column name="source_id" />
        <column name="project_id" />
        <column name="gff_dbxref"/>
        <sqlParamValue name="brcName" includeProjects="PlasmoDB">ApiDB_PlasmoDB</sqlParamValue>
        <sqlParamValue name="brcName" includeProjects="CryptoDB">ApiDB_CryptoDB</sqlParamValue>
        <sqlParamValue name="brcName" includeProjects="ToxoDB">ApiDB_ToxoDB</sqlParamValue>
        <sqlParamValue name="brcName" includeProjects="GiardiaDB,TrichDB,TriTrypDB">ApiDB</sqlParamValue>
        <sql>
          <![CDATA[
            SELECT ens.source_id, '@PROJECT_ID@' AS project_id,
                   'taxon:' || t.ncbi_tax_id AS gff_dbxref
            FROM dots.NaSequence ens, sres.Taxon t
            WHERE ens.taxon_id = t.taxon_id
/*           UNION
            SELECT ens.source_id, '@PROJECT_ID@' AS project_id, so.so_id AS gff_dbxref
            FROM dots.NaSequence ens, sres.SequenceOntology so
            WHERE ens.sequence_ontology_id = so.sequence_ontology_id
*/           UNION
            SELECT ens.source_id,  '@PROJECT_ID@' AS project_id,
                   'GenBank:' || dr.primary_identifier AS gff_dbxref
            FROM dots.NaSequence ens, dots.dbrefNaSequence drns,
                 sres.DbRef dr, sres.ExternalDatabaseRelease edr,
                 sres.ExternalDatabase ed
            WHERE ens.na_sequence_id = drns.na_sequence_id
              AND drns.db_ref_id = dr.db_ref_id
              AND dr.external_database_release_id
                  = edr.external_database_release_id
              AND edr.external_database_id = ed.external_database_id
              AND ed.name = 'GenBank'
           UNION
            SELECT ens.source_id, '@PROJECT_ID@' AS project_id,
                   '&&brcName&&:' || ens.source_id AS gff_dbxref
            FROM dots.NaSequence ens
          ]]>
        </sql>
    </sqlQuery>

  </querySet>

</wdkModel>
