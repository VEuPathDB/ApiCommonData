<wdkModel>

    <querySet name="EstAttributes" queryType="attribute">

      <defaultTestParamValues includeProjects="PlasmoDB">
         <paramValue name="source_id">AU087658</paramValue>
         <paramValue name="project_id">PlasmoDB</paramValue>
      </defaultTestParamValues>

      <defaultTestParamValues includeProjects="ToxoDB">
         <paramValue name="source_id">AA011889</paramValue>
         <paramValue name="project_id">ToxoDB</paramValue>
      </defaultTestParamValues>

      <defaultTestParamValues includeProjects="CryptoDB">
         <paramValue name="source_id">AA555430</paramValue>
         <paramValue name="project_id">CryptoDB</paramValue>
      </defaultTestParamValues>

      <defaultTestParamValues includeProjects="GiardiaDB">
         <paramValue name="source_id">AT002319</paramValue>
         <paramValue name="project_id">GiardiaDB</paramValue>
      </defaultTestParamValues>

      <defaultTestParamValues includeProjects="TrichDB">
         <paramValue name="source_id">CV202110</paramValue>
         <paramValue name="project_id">TrichDB</paramValue>
      </defaultTestParamValues>

      <!--TODO revisit the source_id, its correct but is a random source_id-->
      <defaultTestParamValues includeProjects="TriTrypDB">
         <paramValue name="source_id">CF890597</paramValue>
         <paramValue name="project_id">TriTrypDB</paramValue>
      </defaultTestParamValues>

      <testRowCountSql>
               select count(*)
               from dots.nasequence s, sres.SequenceOntology so
               where so.sequence_ontology_id = s.sequence_ontology_id
                 and so.term_name = 'EST'
       </testRowCountSql>

       <sqlQuery name="Bfmv">
            <column name="source_id" ignoreCase="true"/>
            <column name="project_id"/>
            <column name="a_count" />
            <column name="c_count" />
            <column name="g_count" />
            <column name="t_count" />
            <column name="other_count" />
            <column name="length" />
            <column name="primer"  ignoreCase="true"/>
            <column name="dbest_name"  ignoreCase="true"/>
            <column name="assembly_source_id"  ignoreCase="true"/>
            <column name="vector"  ignoreCase="true"/>
            <column name="stage"  ignoreCase="true"/>
            <column name="organism"  ignoreCase="true"/>
            <column name="formatted_organism"  sortingColumn="organism" ignoreCase="true"/>
            <column name="ncbi_tax_id"  ignoreCase="true"/>
            <column name="external_db_name"  ignoreCase="true"/>
            <column name="assembly_est_count"  includeProjects="CryptoDB,ToxoDB,GiardiaDB,TriTrypDB"/>
            <sql includeProjects="PlasmoDB,EuPathDB">
            <![CDATA[
           SELECT bfmv.source_id, bfmv.project_id, bfmv.primer, bfmv.a_count,  bfmv.c_count, 
                  bfmv.g_count, bfmv.t_count, bfmv.other_count, bfmv.length, 
                  bfmv.assembly_source_id as assembly_source_id,
                  bfmv.dbest_name, bfmv.vector, bfmv.stage, bfmv.organism,
                  bfmv.ncbi_tax_id,
                  '<i>' || SUBSTR(bfmv.organism, 1, 1) || '.' ||
                  REGEXP_REPLACE(SUBSTR(bfmv.organism, INSTR(bfmv.organism, ' ')), '[[:space:]]+',
                                 chr(38) || 'nbsp;') || '</i>'
                    AS formatted_organism,
                  bfmv.external_db_name
            FROM  apidb.EstAttributes bfmv
            ]]>
           </sql>

            <sql includeProjects="CryptoDB,ToxoDB,GiardiaDB,TrichDB,TriTrypDB">
            <![CDATA[
           SELECT bfmv.source_id, bfmv.project_id, bfmv.primer, bfmv.a_count,  bfmv.c_count, 
                  bfmv.g_count, bfmv.t_count, bfmv.other_count, bfmv.length, 
                  bfmv.assembly_source_id as assembly_source_id, 
                  bfmv.dbest_name, bfmv.vector, bfmv.stage,
                  CASE bfmv.organism when 'Giardia intestinalis' THEN 'Giardia lamblia' else bfmv.organism END as organism,
                  bfmv.ncbi_tax_id,
                  '<i>' || SUBSTR(bfmv.organism, 1, 1) || '.' ||
                  REGEXP_REPLACE(SUBSTR(CASE bfmv.organism when 'Giardia intestinalis' THEN 'Giardia lamblia' else bfmv.organism END, INSTR(bfmv.organism, ' ')), '[[:space:]]+',
                                 chr(38) || 'nbsp;') || '</i>'
                    AS formatted_organism,
                  bfmv.external_db_name, bfmv.assembly_est_count
            FROM  apidb.EstAttributes bfmv
            ]]>
           </sql>
        </sqlQuery>

        <sqlQuery name="Sequence">
            <column name="source_id" />
            <column name="project_id" />
            <column name="sequence" />
            <sql>
                <![CDATA[
                  SELECT source_id, '@PROJECT_ID@' as project_id, sequence
                  FROM   apidb.estSequence
                ]]>
           </sql>
        </sqlQuery>

        <sqlQuery name="LinkOut">
            <column name="source_id" />
            <column name="project_id" />
            <column name="linkout" />
            <sql>
            <![CDATA[
            SELECT source_id, '@PROJECT_ID@' as project_id,
                CASE 
                  WHEN bfmv.dbest_name = 'WatanabeCpHNJ-1' then
                     '<a href="http://fullmal.hgc.jp/cgi-bin/fulcrypto_start.cgi?UID=11&SEE=1&MXX=750&VSP=&ONF=&SMF=0&VPLN=sp005%7Cstcrm%7Csp005%7Cgn0110%7Csp003%7Ccl0110%7Csp003%7Ccl0610%7Cscale%7Ccl0600%7Csp003%7Ccl0100%7Csp003%7Cgn0100%7C&SRH=1%21'|| bfmv.source_id || '">Full-Cryptosporidium</a>'
                  WHEN bfmv.dbest_name = 'WatanabeTgRH' then 
                      '<a href="http://fullmal.hgc.jp/cgi-bin/fultoxo_start.cgi?UID=11&SEE=1&MXX=750&VSP=&ONF=&SMF=0&VPLN=sp005%7Cstcrm%7Csp005%7Cgn0210%7Csp003%7Cgn0310%7Csp003%7Cgn0410%7Csp003%7Cgn0510%7Csp003%7Ccl0210%7Csp003%7Ccl0110%7Csp003%7Ccl0610%7Cscale%7Ccl0600%7Csp003%7Ccl0100%7Csp003%7Ccl0200%7Csp003%7Cgn0500%7Csp003%7Cgn0400%7Csp003%7Cgn0200%7Csp003%7Cgn0300%7C&SRH=1%21' || bfmv.source_id || '">Full-Toxoplasma</a>'
                  WHEN bfmv.dbest_name = 'WatanabePf3D7_cultured' then 
                      '<a href="http://fullmal.hgc.jp/cgi-bin/fulmal_start.cgi?UID=11&SEE=1&MXX=750&VSP=&ONF=&SMF=0&VPLN=sp005%7Cstcrm%7Csp005%7Ccl0211%7Csp003%7Ccy0611%7Csp003%7Cyomch0%7Csp003%7Ccy0601%7Csp003%7Ccl0201%7Csp003%7Ccb0111%7Csp003%7Ccb0611%7Csp003%7Cct080%7Csp003%7Ccb0601%7Csp003%7Ccb0101%7Csp003%7Ccv0111%7Csp003%7Ccv0611%7Csp003%7Cct170%7Csp003%7Ccv0601%7Csp003%7Ccv0101%7Csp003%7Csp007%7Cgn0410%7Csp003%7Ccl0610%7Cscale%7Ccl0600%7Csp003%7Cgn0400%7Csp003%7C&SRH=1%21' || bfmv.source_id || '">Full-Malaria</a>'
                  WHEN bfmv.external_db_name = 'C. parvum ESTs' then 
                      '<a href="http://www.ncbi.nlm.nih.gov/entrez/viewer.fcgi?val=' || bfmv.source_id || '">NCBI</a>'
                  WHEN bfmv.external_db_name = 'dbEST' then 
                      '<a href="http://www.ncbi.nlm.nih.gov/entrez/viewer.fcgi?val=' || bfmv.source_id || '">NCBI</a>'
                  ELSE 'none'
                END
                as linkout
            FROM  apidb.EstAttributes bfmv
            ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="Reference">
            <column name="source_id" />
            <column name="project_id" />
            <column name="author" />
            <column name="affiliation" />
            <column name="address" />
            <sql>
            <![CDATA[
            SELECT e.accession as source_id, '@PROJECT_ID@' as project_id,
                   c.name as author,
                   c.address1 as affiliation,
                   c.address2 as address
            FROM dots.est e, sres.contact c, 
                 dots.externalnasequence ens, sres.sequenceontology so
            WHERE e.contact_id = c.contact_id
            and ens.na_sequence_id = e.na_sequence_id
            and ens.sequence_ontology_id = so.sequence_ontology_id
            and so.term_name = 'EST'
            ]]>
            </sql>
        </sqlQuery>


    </querySet>


</wdkModel>
