<wdkModel>

    <recordClassSet name="EstRecordClasses">

        <!-- EstRecordClasses.EstRecordClass -->
        <recordClass name="EstRecordClass" type="EST">

      <testParamValues includeProjects="PlasmoDB">
         <paramValue name="source_id">AU087658</paramValue>
         <paramValue name="project_id">PlasmoDB</paramValue>
      </testParamValues>

      <testParamValues includeProjects="ToxoDB">
         <paramValue name="source_id">AA011889</paramValue>
         <paramValue name="project_id">ToxoDB</paramValue>
      </testParamValues>

      <testParamValues includeProjects="CryptoDB">
         <paramValue name="source_id">AA555430</paramValue>
         <paramValue name="project_id">CryptoDB</paramValue>
      </testParamValues>

      <testParamValues includeProjects="GiardiaDB">
         <paramValue name="source_id">AT002319</paramValue>
         <paramValue name="project_id">GiardiaDB</paramValue>
      </testParamValues>

      <testParamValues includeProjects="TrichDB">
         <paramValue name="source_id">CV202110</paramValue>
         <paramValue name="project_id">TrichDB</paramValue>
      </testParamValues>


            <!-- primary key definition -->
            <primaryKeyAttribute name="primary_key"
                                 displayName="EST">
                <columnRef>source_id</columnRef>
                <columnRef>project_id</columnRef>
                <text>
                    <![CDATA[
                      $$source_id$$
                    ]]>
                </text>                
            </primaryKeyAttribute>

          <!-- =============================================================== -->
          <!--   Reporters -->  
          <!-- =============================================================== -->
          <reporter name="tabular" displayName="Summary - TAB Delimited"
                    implementation="org.gusdb.wdk.model.report.TabularReporter"/>
          <reporter name="fullRecord" displayName="Detailed" excludeProjects="ApiDB" 
                    implementation="org.gusdb.wdk.model.report.FullRecordReporter"/>

           <!-- =================================================================== -->
           <!--  Attributes  ++++++++-->
           <!-- =================================================================== -->

              <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
              <!-- BFMV attributes -->  
              <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

            <attributeQueryRef ref="EstAttributes.Bfmv">
                <columnAttribute name="source_id"   inReportMaker="false" displayName="Accession" internal="true"/>
                <columnAttribute name="a_count"     inReportMaker="false" internal="true"/>
                <columnAttribute name="c_count"     inReportMaker="false" internal="true"/>
                <columnAttribute name="g_count"     inReportMaker="false" internal="true"/>
                <columnAttribute name="t_count"     inReportMaker="false" internal="true"/>
                <columnAttribute name="other_count" inReportMaker="false" internal="true"/>
                <columnAttribute name="length"      displayName="Length"  align="center"/>
                <columnAttribute name="primer"      inReportMaker="false" internal="true"/>
                <columnAttribute name="dbest_name"  displayName="Library" internal="false"/>

                <columnAttribute name="assembly_source_id" displayName="Assembly Source Id" internal="true" />
                <linkAttribute displayName="Assembly" inReportMaker="false" name="assembly_link" includeProjects="CryptoDB,ToxoDB,GiardiaDB">
                    <displayText>
                        <![CDATA[ $$assembly_source_id$$ ]]>
                    </displayText>
                     <url>
                        <![CDATA[showRecord.do?name=AssemblyRecordClasses.AssemblyRecordClass&project_id=@project_id@&source_id=$$assembly_source_id$$]]>
                     </url>
                </linkAttribute>
                <columnAttribute name="assembly_est_count"  displayName="# ESTs in Assembly" internal="false" 
                    align="center" includeProjects="CryptoDB,ToxoDB,GiardiaDB"/>

                <columnAttribute name="vector"      displayName="Vector" internal="false"/>
                <columnAttribute name="stage"       displayName="Stage" internal="false"/>
                <columnAttribute name="organism"    displayName="Organism" internal="true"/>
                <columnAttribute name="formatted_organism"    displayName="Organism" internal="false" inReportMaker="false"/>
                <columnAttribute name="ncbi_tax_id" displayName="NCBI taxon" internal="true"/>
                <columnAttribute name="external_db_name"   inReportMaker="false" internal="true"/>
            </attributeQueryRef>

            <attributeQueryRef ref="EstAttributes.Sequence">
                <columnAttribute name="sequence" displayName="Sequence" internal="true"/>
            </attributeQueryRef>

            <table name="ReferenceInfo" displayName="Reference" queryRef="EstAttributes.Reference" excludeProjects="ApiDB">
                <columnAttribute inReportMaker="false" name="source_id" displayName="Source ID"     internal="true" />
                <columnAttribute inReportMaker="false" name="author"   displayName="Author"    internal="false" />
                <columnAttribute inReportMaker="false" name="affiliation" displayName="Affiliation" internal="false" />
                <columnAttribute inReportMaker="false" name="address"     displayName="Address" internal="false" />
            </table>

           <!--
            <attributeQueryRef ref="EstAttributes.Reference" excludeProjects="ApiDB">
                <columnAttribute inReportMaker="false" name="author"      internal="true" />
                <columnAttribute inReportMaker="false" name="affiliation" internal="true" />
                <columnAttribute inReportMaker="false" name="address"     internal="true" />
            </attributeQueryRef>
   -->

            <attributeQueryRef ref="EstAttributes.LinkOut" excludeProjects="ApiDB">
                <columnAttribute inReportMaker="false" name="linkout"     internal="true" />
            </attributeQueryRef>

            <textAttribute name="overview" displayName="Overview" inReportMaker="false" internal="true">
               <text>
                    <![CDATA[
                    Library: $$dbest_name$$<br>
                    Primer: $$primer$$<br>
		    Vector: $$vector$$<br>
		    Stage:  $$stage$$<br>
                    Residue counts: <b>A</b>:$$a_count$$, <b>T</b>:$$t_count$$, <b>C</b>:$$c_count$$,
                    <b>G</b>:$$g_count$$, <b>other</b>:$$other_count$$<br>
                    Length: $$length$$<br>
                    Link out: $$linkout$$
                ]]>
               </text>
           </textAttribute>

           <!-- custom record jsp page has a dependency on this attribute name. if you change here, change there -->
   <!--        <textAttribute name="reference" displayName="Sequence Attribution" inReportMaker="false" internal="true">
              <text>
                   <![CDATA[
                   <font size="-1">$$author$$<br>$$affiliation$$<br> $$address$$</font>
                   ]]>
              </text>
           </textAttribute>-->


      <!-- =================================================================== -->
      <!-- Tables ++++++++-->
      <!-- =================================================================== -->

            <table name="AlignmentInfo" excludeProjects="ApiDB" 
                   displayName="Alignments to genomic sequence"
                   queryRef="EstTables.AlignmentInfo">
                <columnAttribute inReportMaker="true"  name="accession" displayName="Accession"   internal="false" />
                <linkAttribute displayName="Genomic sequence" name="alignedcontig"
                   inReportMaker="false" internal="false" >
                    <displayText>
                        <![CDATA[ $$sequence_id$$ ]]>
                    </displayText>
                     <url>
                        <![CDATA[showRecord.do?name=SequenceRecordClasses.SequenceRecordClass&project_id=@project_id@&source_id=$$sequence_id$$]]>
                     </url>
                </linkAttribute>
                <textAttribute inReportMaker="true" name="location" displayName="Location">
                  <text>
                    <![CDATA[
                      $$target_start$$ - $$target_end$$ ($$is_reversed$$)
                    ]]>
                  </text>
                </textAttribute>
                <columnAttribute inReportMaker="false"  name="context_start" internal="true" />
                <columnAttribute inReportMaker="false"  name="context_end"   internal="true" />
                <columnAttribute inReportMaker="true"  name="percent_identity" displayName="Percent identity"  internal="false" />
                <columnAttribute inReportMaker="true"  name="is_best_alignment" displayName="Best alignment?"  internal="false" />
                <columnAttribute inReportMaker="true"  name="is_consistent" displayName="Consistent?"  internal="false" />
                <columnAttribute inReportMaker="true"  name="gene" internal="true" />

                <linkAttribute displayName="Gene" name="gene_link"
                   inReportMaker="false" internal="false" >
                    <displayText>
                        <![CDATA[ $$gene$$ ]]>
                    </displayText>
                     <url>
                        <![CDATA[
                       showRecord.do?name=GeneRecordClasses.GeneRecordClass&project_id=$$project_id$$&source_id=$$gene$$
  ]]>
                     </url>
                </linkAttribute>


                <columnAttribute inReportMaker="true"  name="sequence_id" displayName="Sequence"    internal="true" />
                <columnAttribute inReportMaker="true"  name="target_start" displayName="Start" internal="true" />
                <columnAttribute inReportMaker="true"  name="target_end"  displayName="End" internal="true" />
                <columnAttribute inReportMaker="true"  name="is_reversed" displayName="Strand" internal="true" />
                <linkAttribute displayName="Alignment" name="alignmentlink"
                   inReportMaker="false" internal="false" >
                    <displayText>
                        <![CDATA[ view ]]>
                    </displayText>
                     <url includeProjects="PlasmoDB">
                        <![CDATA[
                        /cgi-bin/gbrowse/plasmodb/?name=$$sequence_id$$%3A$$context_start$$-$$context_end$$;width=550;label=Gene;label=EST;h_feat=$$accession$$
                        ]]>
                     </url>
                     <url includeProjects="GiardiaDB">
                        <![CDATA[
                        /cgi-bin/gbrowse/giardiadb/?name=$$sequence_id$$%3A$$context_start$$-$$context_end$$;width=550;label=Gene;label=EST;h_feat=$$accession$$
                        ]]>
                     </url>
                     <url includeProjects="TrichDB">
                        <![CDATA[
                        /cgi-bin/gbrowse/trichdb/?name=$$sequence_id$$%3A$$context_start$$-$$context_end$$;width=550;label=Gene;label=EST;h_feat=$$accession$$
                        ]]>
                     </url>
                     <url includeProjects="CryptoDB">
                        <![CDATA[
                        /cgi-bin/gbrowse/cryptodb/?name=$$sequence_id$$%3A$$context_start$$-$$context_end$$;width=550;label=Gene;label=EST;h_feat=$$accession$$
                        ]]>
                     </url>
                     <url includeProjects="ToxoDB">
                        <![CDATA[
                        /cgi-bin/gbrowse/toxodb/?name=$$sequence_id$$%3A$$context_start$$-$$context_end$$;width=550;label=Gene;label=EST;h_feat=$$accession$$
                        ]]>
                     </url>
                </linkAttribute>
            </table>


            <table name="ClusterMates" excludeProjects="ApiDB,PlasmoDB" 
                   displayName="Other ESTs that Cluster with this EST:" 
                   queryRef="EstTables.ClusterMates">
                <columnAttribute displayName="ID" name="mate_id" internal="true" />
                <linkAttribute displayName="ID" name="mate_link">
                    <displayText>
                        <![CDATA[ $$mate_id$$ ]]>
                    </displayText>
                     <url>
                        <![CDATA[showRecord.do?name=EstRecordClasses.EstRecordClass&project_id=&source_id=$$mate_id$$]]>
                     </url>
                </linkAttribute>
                
                <!-- not clustering with mRNA's this release, so turn off mate_type -->
                <columnAttribute displayName="EST/mRNA" name="mate_type"  internal="true" />
            </table>
            

            <table name="AssemblyInfo" excludeProjects="ApiDB,PlasmoDB" 
                   displayName="Assembly for this EST" 
                   queryRef="EstTables.AssemblyInfo">
                <columnAttribute displayName="Assembly" name="assembly_source_id" internal="true" />
                <linkAttribute displayName="Assembly" name="assembly_link">
                    <displayText>
                        <![CDATA[ $$assembly_source_id$$ ]]>
                    </displayText>
                    <url >
                        <![CDATA[showRecord.do?name=AssemblyRecordClasses.AssemblyRecordClass&project_id=@project_id@&source_id=$$assembly_source_id$$]]>
                    </url>
                </linkAttribute>
                
                <columnAttribute inReportMaker="false" name="assembly_length" displayName="Length" />
                <columnAttribute inReportMaker="false" name="number_of_contained_sequences" displayName="Number of ESTs" />
            </table>
            

       </recordClass>
    </recordClassSet>

</wdkModel>
