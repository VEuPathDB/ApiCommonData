#!/usr/bin/perl
#vvvvvvvvvvvvvvvvvvvvvvvvv GUS4_STATUS vvvvvvvvvvvvvvvvvvvvvvvvv
  # GUS4_STATUS | SRes.OntologyTerm              | auto   | absent
  # GUS4_STATUS | SRes.SequenceOntology          | auto   | absent
  # GUS4_STATUS | Study.OntologyEntry            | auto   | absent
  # GUS4_STATUS | SRes.GOTerm                    | auto   | absent
  # GUS4_STATUS | Dots.RNAFeatureExon            | auto   | absent
  # GUS4_STATUS | RAD.SageTag                    | auto   | absent
  # GUS4_STATUS | RAD.Analysis                   | auto   | absent
  # GUS4_STATUS | ApiDB.Profile                  | auto   | absent
  # GUS4_STATUS | Study.Study                    | auto   | absent
  # GUS4_STATUS | Dots.Isolate                   | auto   | absent
  # GUS4_STATUS | DeprecatedTables               | auto   | absent
  # GUS4_STATUS | Pathway                        | auto   | absent
  # GUS4_STATUS | DoTS.SequenceVariation         | auto   | absent
  # GUS4_STATUS | RNASeq Junctions               | auto   | absent
  # GUS4_STATUS | Simple Rename                  | auto   | absent
  # GUS4_STATUS | ApiDB Tuning Gene              | auto   | absent
  # GUS4_STATUS | Rethink                        | auto   | absent
  # GUS4_STATUS | dots.gene                      | manual | unreviewed
die 'This file has broken or unreviewed GUS4_STATUS rules.  Please remove this line when all are fixed or absent';
#^^^^^^^^^^^^^^^^^^^^^^^^^ End GUS4_STATUS ^^^^^^^^^^^^^^^^^^^^

##to be used to transform from the directory structure generated by workflow to old webservices structure
## both sourceDir and targetDir must be full paths to these directories

use strict;
use Getopt::Long;

my($targetDir,$sourceDir,$projectName,$projectName);

&GetOptions("targetDir|t=s" => \$targetDir,
            "sourceDir|s=s" => \$sourceDir,
            "projectName=s" => \$projectName

            );

die "you must use fully qualified path for --targetDir and --sourceDir --projectName\\n" unless ($sourceDir =~ /^\// && $targetDir =~ /^\// && $projectName =~ /DB/ );
die "sourceDir $sourceDir does not exist\n" unless -d "$sourceDir";
mkdir("$targetDir") unless -e "$targetDir";
mkdir("$targetDir/blast") unless -e "$targetDir/blast";
mkdir("$targetDir/motif") unless -e "$targetDir/motif";

chdir($sourceDir);

my @orgs = glob("*");

foreach my $org (@orgs){
  if($org eq 'mercator'){
    print STDERR "Moving mercator directory to $targetDir\n";
    system("mv $org $targetDir");
    next;
  }
  chdir($org);
  print STDERR "Organism = $org\n";
  my @wsdir = glob("*");
  foreach my $dir (@wsdir){
    print STDERR "dir = $dir\n";
    chdir($dir);
    my @files = glob("*");
    foreach my $file (@files){
      next if ($file =~ m/^\./);
      my ($name,$ext) = split(/\./,$file);
      my $fn;  # final name for the copied file

      # adjustments for blast and motif filenames, in accordance other component sites
      if ($dir eq 'blast') {
	$name = 'ORF' if ($name eq 'ORFs_AA');
	$name = 'Genomics' if ($name eq 'Genome');
	$name = 'EST' if ($name eq 'ESTs');
	$name = 'Proteins' if ($name eq 'AnnotatedProteins');
	$name = 'Transcripts' if ($name eq 'AnnotatedTranscripts');

	$fn = "${org}${name}.${ext}";
      }
      if ($dir eq 'motif') {
	$name = 'ORFs' if ($name eq 'ORFs_AA');
	$name = 'Genomic' if ($name eq 'GenomeDoubleStrand');

	$fn = "${org}${name}_${projectName}.${ext}";
      }

      my $cmd ="cp $file $targetDir/$dir/$fn";
      print STDERR "$cmd\n";
      system($cmd);
    }
    chdir("$sourceDir/$org");
  } 
  chdir($sourceDir);
}

